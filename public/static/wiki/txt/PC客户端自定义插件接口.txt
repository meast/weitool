<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>目录</h2></div><ul><li class="toclevel-1 tocsection-1"><a href="#PC.E5.AE.A2.E6.88.B7.E7.AB.AF.E8.87.AA.E5.AE.9A.E4.B9.89.E9.A1.B5.E9.9D.A2.E6.8F.92.E4.BB.B6.E6.8E.A5.E5.8F.A3"><span class="tocnumber">1</span> <span class="toctext">PC客户端自定义页面插件接口</span></a><ul><li class="toclevel-2 tocsection-2"><a href="#.E6.8E.A5.E5.8F.A3.E8.B0.83.E8.AF.95"><span class="tocnumber">1.1</span> <span class="toctext">接口调试</span></a></li><li class="toclevel-2 tocsection-3"><a href="#.E5.90.91.E4.BC.9A.E8.AF.9D.E7.AA.97.E5.8F.A3.E8.BE.93.E5.85.A5.E6.A1.86.E4.B8.AD.E8.BE.93.E5.85.A5.E4.B8.80.E6.9D.A1.E6.B6.88.E6.81.AF"><span class="tocnumber">1.2</span> <span class="toctext">向会话窗口输入框中输入一条消息</span></a></li><li class="toclevel-2 tocsection-4"><a href="#.E9.AB.98.E4.BA.AE.E8.87.AA.E5.AE.9A.E4.B9.89.E6.8F.92.E4.BB.B6Tab.E9.A1.B5"><span class="tocnumber">1.3</span> <span class="toctext">高亮自定义插件Tab页</span></a></li><li class="toclevel-2 tocsection-5"><a href="#.E4.BA.8B.E4.BB.B6.E6.8E.A5.E5.8F.A3_-_.E5.88.87.E6.8D.A2.E5.BD.93.E5.89.8D.E4.BC.9A.E8.AF.9D.E7.94.A8.E6.88.B7"><span class="tocnumber">1.4</span> <span class="toctext">事件接口 - 切换当前会话用户</span></a></li><li class="toclevel-2 tocsection-6"><a href="#.E4.BA.8B.E4.BB.B6.E6.8E.A5.E5.8F.A3_-_.E5.AE.A2.E6.9C.8D.E7.82.B9.E5.87.BB.E5.9C.B0.E7.90.86.E6.B6.88.E6.81.AF"><span class="tocnumber">1.5</span> <span class="toctext">事件接口 - 客服点击地理消息</span></a></li></ul></li></ul></td></tr></table><h3> <span class="mw-headline" id="PC.E5.AE.A2.E6.88.B7.E7.AB.AF.E8.87.AA.E5.AE.9A.E4.B9.89.E9.A1.B5.E9.9D.A2.E6.8F.92.E4.BB.B6.E6.8E.A5.E5.8F.A3"><b>PC客户端自定义页面插件接口</b></span></h3><p>在PC多客服客户端中，我们预留了开放能力，您可以在多客服聊天窗口右侧区域添加自己的自定义web页面插件（推荐页面宽度为420px），通过多客服客户端提供的JavaScript接口，您的页面可以与多客服客户端进行交互，实现自己需要的功能，如常用回复、信息查询等。</p><p>当需要添加自定义web页面插件时，你需要先进入微信公众平台，“功能-多客服”，选择“客户端高级设置”，选择添加新插件，输入您的页面地址和插件名称，然后重新登录多客服pc客户端，即可在聊天窗口右侧查看到新添加插件页面。（你可以先填写“demo”和<a href="http://dkf.qq.com/demopage.html" class="external free" rel="nofollow">http://dkf.qq.com/demopage.html</a> ，使用官方demo进行体验）。</p><p>添加插件示意图如下：<a href="http://mp.weixin.qq.com/wiki/index.php??title=%E6%96%87%E4%BB%B6:1.png" target="_blank" class="image" title="1"><img alt="1" src="wiki/images/4/4a/1.png" width="744" height="636" /></a></p><p>添加官方demo插件后，效果图如下：<a href="http://mp.weixin.qq.com/wiki/index.php??title=%E6%96%87%E4%BB%B6:3.png" target="_blank" class="image" title="3"><img alt="3" src="wiki/images/1/10/3.png" width="700" height="463" /></a></p><p>多客服客户端提供了一系列JavaScript方法接口，在多客服中加载的插件页面可以通过JavaScript调用客户端提供的方法。下面详细介绍这些接口。</p><h4> <span class="mw-headline" id=".E6.8E.A5.E5.8F.A3.E8.B0.83.E8.AF.95"><b>接口调试</b></span></h4><p>当需要调试自定义插件页面时，你可以通过Chrome浏览器中按F12，打开网页调试工具，来对自定义插件页面进行调试。<a href="http://mp.weixin.qq.com/wiki/index.php??title=%E6%96%87%E4%BB%B6:6.png" target="_blank" class="image" title="6"><img alt="6" src="wiki/images/f/f1/6.png" width="800" height="365" /></a></p><p>当需要在多客服PC客户端中调试时，你可以在多客服插件页面中按”Ctrl+Alt+0”，即可显示客户端交互信息窗口，窗口中能够显示插件页面与客户端的方法和事件交互日志，方便开发者调试方法调用和事件通知，最后按“Alt+F4”关闭该窗口。<a href="http://mp.weixin.qq.com/wiki/index.php??title=%E6%96%87%E4%BB%B6:4.png" target="_blank" class="image" title="4"><img alt="4" src="wiki/images/0/09/4.png" width="567" height="278" /></a></p><h4> <span class="mw-headline" id=".E5.90.91.E4.BC.9A.E8.AF.9D.E7.AA.97.E5.8F.A3.E8.BE.93.E5.85.A5.E6.A1.86.E4.B8.AD.E8.BE.93.E5.85.A5.E4.B8.80.E6.9D.A1.E6.B6.88.E6.81.AF"><b>向会话窗口输入框中输入一条消息</b></span></h4><p>多客服PC客户端中加载的插件web页面可以调用PutMsg方法向当前聊天的会话窗口输入框中输入一条消息，可以支持文本、图片、图文三种消息类型。使用该接口，可以让客服人员快速从你自定义的插件页面中，选中一条内容到输入框中，便于客服发送。</p><p><b>接口调用说明（JavaScript）</b></p><pre>window.external.PutMsg(    ‘{      "msg":         {            "head": {"random": "123456"}            "body"： [{"type":0, "content":{"text":"你好客服001为您服务"}}]        }    }’)</pre><p>head中包含一个随机参数random，请传入一个随机数，相同随机数的调用会被抛弃，避免被异常重复调用。body中是消息的具体内容，各消息类型的参数定义不同，具体消息所对应的json参数如下：</p><p><b>推送文本消息</b></p><pre>{    “type”:0,    “content”:    {        “text”:”文本内容”    }}</pre><p><b>推送图片消息</b></p><pre>{    “type”:1,    “content”:    {        “picUrl”:”图片的url”    }}</pre><p><b>推送图文消息</b></p><pre>{    “type”:1,    “content”:[         {             “title”:”标题”,             “digest”:”摘要”,             “cover”:”封面图片url”,             “url”:” 要跳转的链接”         },         {             “title”:”标题”,             “digest”:”摘要”,             “cover”:”封面图片url”,             “url”:” 要跳转的链接”           }         ]    }}</pre><p><b>返回说明</b></p><p>正确时的返回如下：</p><pre>{retCode:0,errMsg:“”}</pre><p>错误时的返回如下（示例为参数错误）：</p><pre>{"retCode":5,"errMsg":"参数错误"}</pre><h4> <span class="mw-headline" id=".E9.AB.98.E4.BA.AE.E8.87.AA.E5.AE.9A.E4.B9.89.E6.8F.92.E4.BB.B6Tab.E9.A1.B5"><b>高亮自定义插件Tab页</b></span></h4><p>多客服PC客户端以Tab页卡的方式显示多个自定义插件web页面，客服可能会切换到其他插件页面，为了避免客服遗漏非当前显示的插件页面上的重要信息，插件页面可以调用Notice方法使自己的Tab页卡高亮，提示客服切换至您的页面查看信息。</p><p><b>接口调用说明（JavaScript）</b></p><pre>window.external.Notice("");</pre><p><b>返回说明</b></p><p>正确时的返回如下：</p><pre>{retCode:0,errMsg:“”}</pre><h4> <span class="mw-headline" id=".E4.BA.8B.E4.BB.B6.E6.8E.A5.E5.8F.A3_-_.E5.88.87.E6.8D.A2.E5.BD.93.E5.89.8D.E4.BC.9A.E8.AF.9D.E7.94.A8.E6.88.B7"><b>事件接口 - 切换当前会话用户</b></span></h4><p>多客服客户端定义了一系列的事件，客户端会调用插件页面的MCS_ClientNotify(strParam)方法来通知页面。插件页面实现MCS_ClientNotify(strParam)方法，即可收到来自客户端的事件通知，页面可以通过参数中的event字段来区分具体事件类型。</p><p><b>代码示例（JavaScript）</b></p><pre>function MCS_ClientNotify(EventData) {    EventData = strToJson(EventData);    switch(EventData['event']){        case 'OnUserChange':{            OnUserChange(EventData);            break;        }        case 'OnMapMsgClick':{            OnMapMsgClick(EventData);            break;        }    }}function strToJson(str){	var json = (new Function("return " + str))();	return json;}</pre><p>为了方便插件页面获取当前会话的用户，当客服切换会话窗口时多客服客户端会通过OnUserChange事件通知页面，并在参数中带上当前用户的OpenId等信息。插件页面可以响应OnUserChange事件，获取并展示当前用户的相关信息。</p><p><b>MCS_ClientNotify参数:</b></p><pre>MCS_ClientNotify(   {  "event":" OnUserChange ",  " channeltype ":"1",  " useraccount ":"OPENID"  })</pre><table border="1" cellspacing="0" cellpadding="4" align="center" width="640px"><tr><th style="width:120px">参数</th><th>说明</th></tr><tr><td> channeltype</td><td> 用户渠道号，固定为1，表示微信渠道</td></tr><tr><td> useraccount</td><td> 用户的openID</td></tr></table><h4> <span class="mw-headline" id=".E4.BA.8B.E4.BB.B6.E6.8E.A5.E5.8F.A3_-_.E5.AE.A2.E6.9C.8D.E7.82.B9.E5.87.BB.E5.9C.B0.E7.90.86.E6.B6.88.E6.81.AF"><b>事件接口 - 客服点击地理消息</b></span></h4><p>客服人员点击用户发送过来的地理位置消息时，客户端会通过OnMapMsgClick事件通知页面，并在参数中带上经纬度等信息。插件页面可以相应OnMapMsgClick事件，为用户提供基于地理信息的服务。</p><p><b>MCS_ClientNotify参数:</b></p><pre>MCS_ClientNotify(   {  "event":" OnMapMsgClick ",  " latitude ": latitude,  " longitude ": longitude,  " location ": location,  " scale ": scale  })</pre><table border="1" cellspacing="0" cellpadding="4" align="center" width="640px"><tr><th style="width:120px">参数</th><th>说明</th></tr><tr><td> latitude</td><td> 纬度</td></tr><tr><td> longitude</td><td> 经度</td></tr><tr><td> location</td><td> 具体位置文字描述</td></tr><tr><td> scale</td><td> 缩放比例</td></tr></table><!-- NewPP limit reportPreprocessor node count: 22/1000000Post-expand include size: 0/2097152 bytesTemplate argument size: 0/2097152 bytesExpensive parser function count: 0/100--><div class="printfooter">取自“<a href="http://mp.weixin.qq.com/wiki/index.php?title=PC%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E6%8E%A5%E5%8F%A3">http://mp.weixin.qq.com/wiki/index.php?title=PC%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6%E6%8E%A5%E5%8F%A3</a>”</div>